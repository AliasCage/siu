/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 * Copyright (c) 2013, MPL CodeInside http://codeinside.ru
 */

package ru.codeinside.gses.webui.components;

import org.activiti.engine.repository.Deployment;

import ru.codeinside.gses.webui.components.api.IRefresh;
import ru.codeinside.gses.webui.containers.LazyLoadingContainer;
import ru.codeinside.gses.webui.data.AbstractLazyLoadingQuery;
import ru.codeinside.gses.webui.data.DeploymentListQuery;
import ru.codeinside.gses.webui.utils.Components;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Container;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Table;

public class DeploymentListUi extends CustomComponent implements IRefresh {

	private static final long serialVersionUID = -1758527559926694189L;
	@AutoGenerated
	private AbsoluteLayout mainLayout;
	@AutoGenerated
	public Table table_1;

	private AbstractLazyLoadingQuery<Deployment> loadingQuery;

	public DeploymentListUi(AbstractLazyLoadingQuery<Deployment> loadingQuery) {
		this.loadingQuery = loadingQuery;
		buildMainLayout();
		setCompositionRoot(mainLayout);
	}

	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new AbsoluteLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");
		mainLayout.setMargin(false);

		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");

		// table_1
		table_1 = Components.createTable("900px", "500px");

		Container newDataSource = new LazyLoadingContainer(loadingQuery, 15);

		table_1.setContainerDataSource(newDataSource);
		table_1.addContainerProperty("id", String.class, null);
		table_1.addContainerProperty("name", String.class, null);
		table_1.addContainerProperty("time", String.class, null);
		table_1.setColumnHeaders(DeploymentListQuery.COL_HEADERS_ENGLISH);

		mainLayout.addComponent(table_1, "top:0.0px;left:0.0px;");

		return mainLayout;
	}

	@Override
	public void refresh() {
		table_1.getContainerDataSource().removeAllItems();
		table_1.refreshRowCache();
	}

}