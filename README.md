# Система исполнения государственных услуг

## Руководство по сборке исходного кода

### 1. Необходимое ПО

* ОС: целевая платформа - Linux, без проблем подходят дистрибутивы семейства Debian (Ubuntu, Debian, на других не тестировалось, но вряд ли будут какие-то проблемы) 
* ОС MS Windows допустима, но не является целевой серверной платформой.
* java 6, 7
* maven 3
* КриптоПро JCP версии не ниже 1.0.52. Должен быть установлен в jre, используемую при сборке. Так же в хранилище сертификатов должен быть установлен сертификат.

### 2. Краткие инструкции

    cd /repo_name
    mvn install

### 3. Подробные инструкции
* Сборка типична для maven-проектов. 
* Сборка проекта описывается в родительском `pom.xml` файле, находящимся в корне репозитория и в дочерних `pom.xml` для каждого модуля.
* Не все модули, находящиеся в репозитории собираются автоматически при сборке родительского `pom.xml`. Находятся в artifactory и при сборке подтягиваются оттуда следующие модули:
	* `gses-liquibase-api` - спецификация движка миграции БД
	* `gses-liquibase` - реализация движка миграции БД
	* `gses-vaadin` - Vaadin и необходимые виджеты для UI
	
	Некоторые модули носят утилитарный характер и собираются отдельно по необходимости. К таким модулям относятся:

	* `update-script` - вспомогательный модуль, формирующий makeself-архив для выпуска релиза
	* `uat-deployer` - вспомогательный модуль, формирующий набор исполняемых файлов для выпуска последней сборки на staging-сервер в процессе непрерывной интеграции
* В процессе сборки используется внешний репозиторий артифактов maven [http://artifactory.codeinside.ru:8008/artifactory](http://artifactory.codeinside.ru:8008/artifactory), в котором кешируются все внешние артифакты и находятся релизные версии артефактов системы. Т.к как некоторые модули исключены из общей сборки и ищутся в artifactory, то, в случае его недоступности, сборка завершится ошибкой. В случае, если доступ к artifactory по указанному выше адресу отсутствует, необходимо устранить причину его отсутствия, либо раскомментировать в родительском pom.xml файле строки 
        
		<module>gses-liquibase-api</module>
        <module>gses-liquibase</module>
        <module>gses-vaadin</module>
        <module>sign-applet</module> 

  В результате в процессе сборки все необходимые артифакты будут найдены в локальном maven 	репозитории и сборка завершится успешно.
* При необходимости собрать какой-то конкретный модуль, следует перейти в его папку и выполнить 
		`mvn install`
* В результате сборки для всех модулей, включенных в неё будут удовлетворены зависимости, исходный код будет скомпилирован, выполнены автоматические тесты, сформированы исполняемые файлы. Исполняемые файлы будут находиться в `/module_name/target`

### 4. Возможные причины провала сборки
* отсутствует или неправильно установлена java
* отсутствует или неправильно установлен maven
* неправильно установлен компонент КриптоПРО JCP в jre
* отсутствует сертификат КриптоПРО в хранилище сертификатов
